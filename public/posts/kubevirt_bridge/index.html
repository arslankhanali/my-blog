<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Setup Bridge Network for a Kubevirt VM | AK Blogs</title>
<link rel="icon" href="/favicon.svg" sizes="any" type="image/svg+xml" /><meta property="og:url" content="//localhost:1313/posts/kubevirt_bridge/">
  <meta property="og:site_name" content="AK Blogs">
  <meta property="og:title" content="Setup Bridge Network for a Kubevirt VM">
  <meta property="og:description" content="Introduction Kubevirt VM connect to the cluster CNI (Flannel, Calico, etc), which is perfect for pod-to-pod communication but limits VMs that need full LAN access. We will address that by attaching it to the bridge network on host.
Part of series on Kubevirt Create a (homeassistant VM) containerdisk Setup Bridge Network for a Kubevirt VM 1. Prerequisites Before diving in, ensure you have:
A K3s cluster with kubectl or oc access. Linux bridge configured on host (bridge0). jq installed (sudo dnf install jq or brew install jq). Basic knowledge of KubeVirt, CDI, and Kubernetes networking. HLD Home Network
1.1 Router (192.168.50.1): Provides LAN IPs via DHCP.
1.2 User Device: Laptop/Phone accessing VM or cluster services.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-23T17:33:52+10:00">
    <meta property="article:modified_time" content="2025-08-23T17:33:52+10:00">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Multus">
    <meta property="article:tag" content="Kubevirt">
    <meta property="article:tag" content="Networking">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Setup Bridge Network for a Kubevirt VM">
  <meta name="twitter:description" content="Introduction Kubevirt VM connect to the cluster CNI (Flannel, Calico, etc), which is perfect for pod-to-pod communication but limits VMs that need full LAN access. We will address that by attaching it to the bridge network on host.
Part of series on Kubevirt Create a (homeassistant VM) containerdisk Setup Bridge Network for a Kubevirt VM 1. Prerequisites Before diving in, ensure you have:
A K3s cluster with kubectl or oc access. Linux bridge configured on host (bridge0). jq installed (sudo dnf install jq or brew install jq). Basic knowledge of KubeVirt, CDI, and Kubernetes networking. HLD Home Network
1.1 Router (192.168.50.1): Provides LAN IPs via DHCP.
1.2 User Device: Laptop/Phone accessing VM or cluster services.">

    <link rel="stylesheet" href="/css/custom.css">
    <link rel="stylesheet" href="/css/root.css">
    <link rel="stylesheet" href="/css/bundle.css">

      <script src="/js/copy-button.js"></script>
      <script src="/js/bundle.js"></script><script defer src="/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js" integrity="sha256-ZFlLEl97eL30&#43;oMWlVkiu&#43;uxzWuu8/FmVL/KIDCfGPg="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>
<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="//localhost:1313/" style="color: inherit;">AK Blogs</a>
  </div>
  <div class="nav-right">
    <div style="position:absolute;width:0px;height:0px;">
      <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/homelab/"
      >Homelab</a>
    </div>
    <div class="nav-item">
      <a href="/hidden/"
      >Shadow</a>
    </div>
    <div class="nav-item">
      <a href="/about/"
      >About</a>
    </div>
</div>
    </div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/homelab/"
      >Homelab</a>
    </div>
    <div class="nav-item">
      <a href="/hidden/"
      >Shadow</a>
    </div>
    <div class="nav-item">
      <a href="/about/"
      >About</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="//localhost:1313/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span>&nbsp»&nbsp</span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="//localhost:1313/posts/">
        <span itemprop="name">Posts</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span>&nbsp»&nbsp</span>
</ol>
<h1>Setup Bridge Network for a Kubevirt VM</h1><time class="dim" datetime="2025-08-23T17:33:52&#43;10:00">August 23, 2025</time><div class="term-container"><div class="tag">
        <a href="//localhost:1313/tags/kubernetes/">#kubernetes</a>
      </div><div class="tag">
        <a href="//localhost:1313/tags/multus/">#multus</a>
      </div><div class="tag">
        <a href="//localhost:1313/tags/kubevirt/">#kubevirt</a>
      </div><div class="tag">
        <a href="//localhost:1313/tags/networking/">#networking</a>
      </div></ol></div>
  <section class="page-section"><h2 id="introduction">Introduction</h2>
<p>Kubevirt VM connect to the cluster CNI (Flannel, Calico, etc), which is perfect for pod-to-pod communication but limits VMs that need full LAN access. We will address that by attaching it to the bridge network on host.</p>
<h3 id="part-of-series-on-kubevirt">Part of series on Kubevirt</h3>
<ol>
<li><a href="/posts/featured/haos-on-kubevirt/">Create a (homeassistant VM) containerdisk</a></li>
<li><a href="/posts/kubevirt_bridge/">Setup Bridge Network for a Kubevirt VM</a></li>
</ol>
<p><img src="https://images.unsplash.com/photo-1516176966905-58371240ba28?q=80&amp;w=1035&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Bridge"></p>
<hr>
<h2 id="1-prerequisites">1. Prerequisites</h2>
<p>Before diving in, ensure you have:</p>
<ul>
<li>A K3s cluster with <code>kubectl</code> or <code>oc</code> access.</li>
<li>Linux bridge configured on host (<code>bridge0</code>).</li>
<li><code>jq</code> installed (<code>sudo dnf install jq</code> or <code>brew install jq</code>).</li>
<li>Basic knowledge of KubeVirt, CDI, and Kubernetes networking.</li>
</ul>
<hr>
<h2 id="hld">HLD</h2>
<ol>
<li>
<p><strong>Home Network</strong><br>
1.1 <strong>Router (192.168.50.1):</strong> Provides LAN IPs via DHCP.<br>
1.2 <strong>User Device:</strong> Laptop/Phone accessing VM or cluster services.</p>
</li>
<li>
<p><strong>Kubernetes Host</strong><br>
2.1 <strong>Physical NIC (enp3s0):</strong> Connects host to LAN.<br>
2.2 <strong>Linux Bridge (bridge0):</strong> Virtual switch connecting VMs to LAN.<br>
2.3 <strong>Flow:</strong> <code>NIC → Bridge → VM → LAN</code></p>
</li>
<li>
<p><strong>Kubernetes Cluster</strong><br>
3.1 <strong>Multus CNI:</strong> Manages VM network attachments.<br>
3.2 <strong>KubeVirt VM (Fedora):</strong> Attaches to <code>bridge0</code> via <code>homenet</code> NAD.</p>
</li>
<li>
<p><strong>Network Flow</strong><br>
4.1 VM gets LAN IP via DHCP.<br>
4.2 <code>VM ↔ Linux Bridge ↔ Host NIC ↔ Router ↔ LAN</code><br>
4.3 VM can communicate directly with user devices.</p>
</li>
<li>
<p><strong>Key Points</strong><br>
5.1 VM behaves like a normal LAN device.<br>
5.2 LAN devices can access VM directly.<br>
5.3 Multus + bridge allows bypassing pod network NAT.</p>
</li>
</ol>
<pre class="mermaid">
  graph TD
    %% Home Network
    subgraph &#34;Home Network&#34;
        Router[&#34;Router / DHCP Server&lt;br&gt;IP: 192.168.50.1&#34;]
        UserDevice[&#34;Laptop / Phone&#34;]
    end

    %% Kubernetes Host
    subgraph &#34;Kubernetes Host&#34;
        direction LR
        HostNIC[&#34;Physical NIC: enp3s0&#34;]
        LinuxBridge[&#34;Linux Bridge: bridge0&#34;]
        HostNIC --&gt;|Port added to| LinuxBridge
    end

    %% Kubernetes Cluster
    subgraph &#34;Kubernetes Cluster&#34;
        Multus[&#34;Multus CNI&#34;]
        KubeVirtVM[&#34;KubeVirt VM - Fedora&#34;]
    end

    %% Network Flow
    Router --&gt;|DHCP Lease / LAN Traffic| HostNIC
    LinuxBridge --&gt;|Virtual Port| Multus
    Multus --&gt;|Attaches VM to bridge - NAD homenet| KubeVirtVM
    KubeVirtVM --&gt;|Traffic to/from LAN| LinuxBridge
    KubeVirtVM --&gt;|Gets LAN IP| Router
    KubeVirtVM --&gt;|Communicates with| UserDevice
    UserDevice --&gt;|Connects to| KubeVirtVM

    %% Styles
    style Router fill:#fcf,stroke:#333,stroke-width:2px
    style UserDevice fill:#cff,stroke:#333,stroke-width:2px
    style HostNIC fill:#ffc,stroke:#333,stroke-width:2px
    style LinuxBridge fill:#bbf,stroke:#333,stroke-width:2px
    style Multus fill:#ff9,stroke:#333,stroke-width:2px
    style KubeVirtVM fill:#9f9,stroke:#333,stroke-width:2px
</pre>
<hr>
<h2 id="2-why-use-a-bridge-network-for-kubevirt-vms">2. Why use a Bridge Network for KubeVirt VMs</h2>
<p>KubeVirt VMs normally connect to the cluster CNI (Flannel, Calico, etc), which is perfect for pod-to-pod communication but limits VMs that need:</p>
<ul>
<li><strong>LAN visibility</strong> – VM gets an IP on the same subnet as your home devices.</li>
<li><strong>Direct device access</strong> – Talk to IoT devices, NAS, printers without NAT.</li>
<li><strong>Predictable IPs</strong> – DHCP or static assignment for consistent network identity.</li>
</ul>
<p><strong>Solution:</strong> Multus + bridge CNI. The VM attaches to <code>bridge0</code> on the host, making it a full LAN citizen.</p>
<hr>
<h3 id="process-flow">Process flow:</h3>
<pre class="mermaid">
  graph TB
    A[&#34;Create Linux Bridge on Host&#34;] --&gt; B[&#34;Install KubeVirt &amp; CDI&#34;]
    B --&gt; C[&#34;Install Multus&#34;]
    C --&gt; D[&#34;Create NetworkAttachmentDefinition&#34;]
    D --&gt; E[&#34;Deploy VM with Network Attachment&#34;]
</pre>
<hr>
<h2 id="3-host-linux-bridge-setup-bridge0-with-networkmanager">3. Host Linux Bridge Setup (<code>bridge0</code>) with NetworkManager</h2>
<p><code>bridge0</code> is a virtual switch; the physical interface (<code>enp3s0</code>) connects it to your LAN. VMs attach to <code>bridge0</code> via Multus.</p>
<h3 id="cli-steps">CLI Steps</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 3.1 Create the bridge</span>
</span></span><span style="display:flex;"><span>nmcli connection add type bridge con-name bridge0 ifname bridge0 stp no
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.2 Add physical NIC to bridge</span>
</span></span><span style="display:flex;"><span>nmcli connection add type ethernet con-name <span style="color:#e6db74">&#34;Wired Connection&#34;</span> ifname enp3s0 master bridge0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.3 Configure DHCP (or static if desired)</span>
</span></span><span style="display:flex;"><span>nmcli connection modify bridge0 ipv4.method auto
</span></span><span style="display:flex;"><span>nmcli connection modify bridge0 ipv6.method auto
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.4 Enable autoconnect</span>
</span></span><span style="display:flex;"><span>nmcli connection modify bridge0 connection.autoconnect yes
</span></span><span style="display:flex;"><span>nmcli connection modify <span style="color:#e6db74">&#34;Wired Connection&#34;</span> connection.autoconnect yes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.5 Bring up connections</span>
</span></span><span style="display:flex;"><span>nmcli connection up bridge0
</span></span><span style="display:flex;"><span>nmcli connection up <span style="color:#e6db74">&#34;Wired Connection&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.6 Verify setup</span>
</span></span><span style="display:flex;"><span>nmcli connection show
</span></span><span style="display:flex;"><span>nmcli device status
</span></span></code></pre></div><p>✅ <strong>Result:</strong> <code>bridge0</code> is live, VMs attached will get LAN IPs automatically.</p>
<p>💡 <strong>Tip:</strong> Use <code>nmcli</code> on headless servers for fully automated bridge setup.</p>
<hr>
<h2 id="4-install-kubevirt">4. Install KubeVirt</h2>
<p>Deploy the operator and KubeVirt CR to run VMs on Kubernetes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>export KUBEVIRT_VERSION<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s https://api.github.com/repos/kubevirt/kubevirt/releases/latest | jq -r .tag_name<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>echo $KUBEVIRT_VERSION
</span></span><span style="display:flex;"><span>kubectl create -f https://github.com/kubevirt/kubevirt/releases/download/$KUBEVIRT_VERSION/kubevirt-operator.yaml
</span></span><span style="display:flex;"><span>kubectl create -f https://github.com/kubevirt/kubevirt/releases/download/$KUBEVIRT_VERSION/kubevirt-cr.yaml
</span></span><span style="display:flex;"><span>kubectl get pods -n kubevirt
</span></span></code></pre></div><div style="background-color: #24d114ff; padding: 5px; border-left: 5px solid #12cb37ff; border-radius: 10px;">
⭐️ Tip: Wait until all pods in <code>kubevirt</code> namespace are <strong>Running</strong> before continuing.
</div>
<hr>
<h2 id="5-install-containerized-data-importer-cdi">5. Install Containerized Data Importer (CDI)</h2>
<p>CDI handles VM image uploads and DataVolumes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>export CDI_VERSION<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s https://api.github.com/repos/kubevirt/containerized-data-importer/releases/latest | jq -r .tag_name<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>echo $CDI_VERSION
</span></span><span style="display:flex;"><span>kubectl create -f https://github.com/kubevirt/containerized-data-importer/releases/download/$CDI_VERSION/cdi-operator.yaml
</span></span><span style="display:flex;"><span>kubectl create -f https://github.com/kubevirt/containerized-data-importer/releases/download/$CDI_VERSION/cdi-cr.yaml
</span></span><span style="display:flex;"><span>kubectl get pods -n cdi
</span></span><span style="display:flex;"><span><span style="color:#75715e"># kubectl -n cdi port-forward svc/cdi-uploadproxy 8443:443</span>
</span></span></code></pre></div><hr>
<h2 id="6-install-multus-on-k3s">6. Install Multus on K3s</h2>
<p>Multus enables multiple interfaces per VM/pod—essential for bridge networking.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF | oc apply -f-
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: helm.cattle.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: HelmChart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: multus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  repo: https://rke2-charts.rancher.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  chart: rke2-multus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  targetNamespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  valuesContent: |-
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      fullnameOverride: multus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      cni_conf:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        confDir: /var/lib/rancher/k3s/agent/etc/cni/net.d
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        binDir: /var/lib/rancher/k3s/data/cni/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kubeconfig: /var/lib/rancher/k3s/agent/etc/cni/net.d/multus.d/multus.kubeconfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        multusAutoconfigDir: /var/lib/rancher/k3s/agent/etc/cni/net.d
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    manifests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      dhcpDaemonSet: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><hr>
<h2 id="7-create-datavolume-fedora-42">7. Create DataVolume (Fedora 42)</h2>
<p>Create a persistent VM disk.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF | oc apply -f-
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: cdi.kubevirt.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: DataVolume
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cdi.kubevirt.io/storage.bind.immediate.requested: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: fedora-dv-42
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  contentType: kubevirt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  source:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    http:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      url: &#34;https://download.fedoraproject.org/pub/fedora/linux/releases/42/Cloud/x86_64/images/Fedora-Cloud-Base-Generic-42-1.1.x86_64.qcow2&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  storage:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - ReadWriteOnce
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        storage: 10Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><hr>
<h2 id="8-network-attachment-definition">8. Network Attachment Definition</h2>
<p>Attach VM to <code>bridge0</code>. You can choose <strong>DHCP</strong> or <strong>Static IP</strong>.</p>
<div style="margin-bottom: 1em;">
  <input type="radio" id="dhcp" name="network" checked>
  <label for="dhcp" style="margin-right: 1em;">DHCP</label>
  <input type="radio" id="static" name="network">
  <label for="static">Static IP</label>
</div>
<div id="dhcp-code" style="display:block;">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF | oc apply -f-
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: &#34;k8s.cni.cncf.io/v1&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: NetworkAttachmentDefinition
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: homenet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  config: &#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;cniVersion&#34;: &#34;0.3.1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;type&#34;: &#34;bridge&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;bridge&#34;: &#34;bridge0&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;ipam&#34;: { &#34;type&#34;: &#34;dhcp&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div></div>
<div id="static-code" style="display:none;">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF | oc apply -f-
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: &#34;k8s.cni.cncf.io/v1&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: NetworkAttachmentDefinition
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: homenet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  config: &#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;cniVersion&#34;: &#34;0.3.1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;type&#34;: &#34;bridge&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;bridge&#34;: &#34;bridge0&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;ipam&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;type&#34;: &#34;static&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;addresses&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;address&#34;: &#34;192.168.50.204/24&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;gateway&#34;: &#34;192.168.50.1&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;routes&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        { &#34;dst&#34;: &#34;0.0.0.0/0&#34;, &#34;gw&#34;: &#34;192.168.50.1&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;dns&#34;: { &#34;nameservers&#34;: [&#34;192.168.50.1&#34;, &#34;1.1.1.1&#34;] }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div></div>
<script>
const dhcpRadio = document.getElementById('dhcp');
const staticRadio = document.getElementById('static');
const dhcpCode = document.getElementById('dhcp-code');
const staticCode = document.getElementById('static-code');

dhcpRadio.addEventListener('change', () => {
  if(dhcpRadio.checked){
    dhcpCode.style.display = 'block';
    staticCode.style.display = 'none';
  }
});
staticRadio.addEventListener('change', () => {
  if(staticRadio.checked){
    dhcpCode.style.display = 'none';
    staticCode.style.display = 'block';
  }
});
</script>
<h4 id="nad-diagram">NAD diagram</h4>
<pre class="mermaid">
  graph TD
    NAD_Choice{{&#34;Network Attachment Definition&lt;br&gt;(homenet)&#34;}}
    
    subgraph &#34;Option 1: Dynamic IP&#34;
        DHCP[&#34;IPAM: DHCP&#34;]
        DHCP_Config[(&#34;ipam: { type: dhcp }&#34;)]
        NAD_Choice --&gt;|Selects| DHCP
        DHCP --&gt;|Uses CNI Plugin| DHCP_Config
    end

    subgraph &#34;Option 2: Static IP&#34;
        Static[&#34;IPAM: Static&#34;]
        Static_Config[(&#34;ipam: { type: static, addresses: [...] }&#34;)]
        NAD_Choice --&gt;|Selects| Static
        Static --&gt;|Specifies configuration| Static_Config
    end
    
    style NAD_Choice fill:#fff,stroke:#333,stroke-width:2px
</pre>
<hr>
<h2 id="9-create-virtualmachine">9. Create VirtualMachine</h2>
<p>Deploy Fedora VM with <code>homenet</code> interface.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF | oc apply -f-
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: kubevirt.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: VirtualMachine
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: fedora-dv-bridge
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kubevirt.io/os: linux
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  runStrategy: Always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kubevirt.io/domain: vm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      domain:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        cpu:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          cores: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        devices:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          disks:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - name: disk0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            disk:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              bus: virtio
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - name: cloudinitdisk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            cdrom:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              bus: sata
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              readonly: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          interfaces:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - name: homenet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            bridge: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            model: virtio
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        machine:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          type: q35
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            memory: 2048M
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      networks:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - name: homenet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        multus:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          networkName: homenet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - name: disk0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        persistentVolumeClaim:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          claimName: fedora-dv-42
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - name: cloudinitdisk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        cloudInitNoCloud:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          userData: |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            #cloud-config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            hostname: fedora-dv-bridge
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ssh_pwauth: True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            password: fedora
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            chpasswd: {expire: False}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            runcmd:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              - dnf install -y qemu-guest-agent cockpit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              - systemctl enable qemu-guest-agent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              - systemctl enable --now cockpit.socket
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              - systemctl start qemu-guest-agent cockpit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><hr>
<p>🎉 <strong>Congratulations!</strong> Your KubeVirt VM now has a LAN IP, can SSH in, use Cockpit, and interact with home network devices seamlessly.</p>
<hr>
</section></main>
        <footer id="main-footer">
<script src="/js/copy-button.min.4876b98121977026b3ce53c9cb225d818299becf2f6ba9c345fdfbc99911d6dd.js" integrity="sha256-SHa5gSGXcCazzlPJyyJdgYKZvs8va6nDRf37yZkR1t0="></script>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-content">
      <h3>Disclaimer</h3><p><ul>
<li>This content is for educational and experimental purposes only, provided “as is” without warranties. You are solely responsible for how you use it</li>
</ul>
</p>
    </div><div class="side-details">
    <span>1086 words</span>
    <span>10 - 13 minutes read</span><div class="side-details-taxonomy">
        <small>series: 
          <span class="details-taxonomy"><a href="//localhost:1313/series/kubevirt">kubevirt</a></span></small>
      </div><div class="side-details-taxonomy">
        <small>topics: 
          <span class="details-taxonomy"><a href="//localhost:1313/topics/homelab">homelab</a></span><span class="details-taxonomy"><a href="//localhost:1313/topics/vm-networking">vm-networking</a></span></small>
      </div></div><h3>Table Of Contents</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#part-of-series-on-kubevirt">Part of series on Kubevirt</a></li>
      </ul>
    </li>
    <li><a href="#1-prerequisites">1. Prerequisites</a></li>
    <li><a href="#hld">HLD</a></li>
    <li><a href="#2-why-use-a-bridge-network-for-kubevirt-vms">2. Why use a Bridge Network for KubeVirt VMs</a>
      <ul>
        <li><a href="#process-flow">Process flow:</a></li>
      </ul>
    </li>
    <li><a href="#3-host-linux-bridge-setup-bridge0-with-networkmanager">3. Host Linux Bridge Setup (<code>bridge0</code>) with NetworkManager</a>
      <ul>
        <li><a href="#cli-steps">CLI Steps</a></li>
      </ul>
    </li>
    <li><a href="#4-install-kubevirt">4. Install KubeVirt</a></li>
    <li><a href="#5-install-containerized-data-importer-cdi">5. Install Containerized Data Importer (CDI)</a></li>
    <li><a href="#6-install-multus-on-k3s">6. Install Multus on K3s</a></li>
    <li><a href="#7-create-datavolume-fedora-42">7. Create DataVolume (Fedora 42)</a></li>
    <li><a href="#8-network-attachment-definition">8. Network Attachment Definition</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#9-create-virtualmachine">9. Create VirtualMachine</a></li>
  </ul>
</nav><h3>Related</h3>
    <ul><li><a href="/posts/featured/haos-on-kubevirt/">Home Assistant VM on Kubevirt</a></li><li><a href="/hidden/k3s-logins/">K3s Logins</a></li><li><a href="/hidden/k3s/">K3s</a></li><li><a href="/hidden/podman-traefik/">Traefik on Podman with Local Certificates</a></li><li><a href="/homelab/homelab-kubernetes/">Homelab: Kubernetes</a></li></ul></aside></div>
  </div>
  
      <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
      </script>
    
</body>
</html>